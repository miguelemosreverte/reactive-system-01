name: "Flink - Production Grade (High Throughput + Checkpointing)"
description: "Production-grade Flink benchmark with RocksDB incremental checkpoints, exactly-once semantics, and optimized network buffers"
component: flink
runtime: docker
duration: 60000  # 60 seconds for meaningful checkpoint interval testing and stable throughput
concurrency: 200  # High concurrency for throughput

# Production-grade configuration based on Apache Flink documentation and research:
# - RocksDB state backend with incremental checkpoints (stores only deltas)
# - Unaligned checkpoints for better backpressure handling
# - 60s checkpoint interval (Flink recommendation for high-throughput)
# - Exactly-once semantics enabled
#
# References:
# - https://flink.apache.org/2021/07/07/backpressure.html
# - https://nightlies.apache.org/flink/flink-docs-stable/docs/ops/state/large_state_tuning/
# - Uber's Flink production configuration for exactly-once

config:
  httpServer: NONE
  microbatching: false
  kafkaAcks: "1"  # Leader ack for Kafka producer (faster than "all")
  kafkaBatchSize: 131072  # 128KB for high throughput
  kafkaLingerMs: 2  # Low linger for batching without latency

  # Environment variables applied to Flink containers - PRODUCTION CONFIG
  env:
    # Skip non-essential features for benchmark
    SKIP_DROOLS: "true"
    SKIP_TRACING: "true"

    # CHECKPOINTING ENABLED - This is production-grade!
    SKIP_CHECKPOINTING: "false"

    # RocksDB state backend with incremental checkpoints
    USE_ROCKSDB: "true"

    # Unaligned checkpoints for better backpressure handling
    UNALIGNED_CHECKPOINTS: "true"

    # Checkpoint tuning for high throughput
    CHECKPOINT_INTERVAL_MS: "60000"      # 60s interval (Flink recommendation)
    CHECKPOINT_MIN_PAUSE_MS: "30000"     # 30s min pause between checkpoints
    CHECKPOINT_TIMEOUT_MS: "120000"      # 2 min timeout

    # Parallelism matching Kafka partitions
    FLINK_PARALLELISM: "32"
    FLINK_BUFFER_TIMEOUT_MS: "0"  # Flush immediately

    # Benchmark mode for passthrough processing
    BENCHMARK_MODE: "true"
